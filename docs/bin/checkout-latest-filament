#!/bin/bash

DOCS_VERSIONS=(
    1.x
    2.x
    3.x
    4.x
    5.x
)

for v in "${DOCS_VERSIONS[@]}"; do
    major="${v%%.*}"   # 1, 2, 3, 4

    if [ -d "filament/$v" ]; then
        echo "Updating $v..."
        (cd filament/$v && git fetch --tags origin)
    else
        echo "Cloning $v..."
        git clone --no-checkout git@github.com:filamentphp/filament.git "filament/$v"
        (cd filament/$v && git fetch --tags origin)
    fi

    # Try to find the latest stable tag first (no hyphens)
    latest_tag=$(git -C filament/$v tag -l "v${major}.*" --sort=-v:refname \
        | grep -E '^[^ -]+$' \
        | head -n1)

    # If no stable tag found, fall back to latest beta/pre-release tag
    if [ -z "$latest_tag" ]; then
        latest_tag=$(git -C filament/$v tag -l "v${major}.*" --sort=-v:refname \
            | head -n1)
    fi

    if [ -z "$latest_tag" ]; then
        echo "No tag found for $v"
        continue
    fi

    echo "Checking out $latest_tag for $v..."
    (cd filament/$v && git checkout -f "$latest_tag")
done
